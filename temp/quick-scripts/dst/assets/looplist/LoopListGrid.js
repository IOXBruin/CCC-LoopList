
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/looplist/LoopListGrid.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '953d75/mP9JVYFdopLdAm5T', 'LoopListGrid');
// looplist/LoopListGrid.ts

Object.defineProperty(exports, "__esModule", { value: true });
var LoopList_1 = require("./LoopList");
var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property, menu = _a.menu, disallowMultiple = _a.disallowMultiple;
var LoopListGrid = /** @class */ (function (_super) {
    __extends(LoopListGrid, _super);
    function LoopListGrid() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        /// 格子数量 默认为2, 大于2时表示一行有多个或一列有多个 采用 左到右或上到下排列方式
        _this.gridCount = 2;
        /// grid item 开始位置
        _this.centers = [];
        return _this;
    }
    /// 计算grid 的中心
    LoopListGrid.prototype._calculateBoundary = function () {
        _super.prototype._calculateBoundary.call(this);
        if (this.content) {
            this.centers.length = this.gridCount;
            switch (this.movement) {
                case LoopList_1.Movement.Horizontal:
                    {
                        var step = this.content.height / this.gridCount;
                        var start = this.content.height * 0.5 - step * 0.5;
                        for (var idx = 0; idx < this.gridCount; idx++) {
                            this.centers[idx] = start - step * idx;
                        }
                    }
                    break;
                case LoopList_1.Movement.Vertical:
                    {
                        var step = this.content.width / this.gridCount;
                        var start = -this.content.width * 0.5 + step * 0.5;
                        for (var idx = 0; idx < this.gridCount; idx++) {
                            this.centers[idx] = start + step * idx;
                        }
                    }
                    break;
            }
        }
    };
    /// 重写创建逻辑
    LoopListGrid.prototype._updateHorizontal = function (idx, pos) {
        var curCount = this._items.length;
        /// recycle all items
        if (this._totalcount == 0) {
            curCount > 0 && this._recycleAllItems(true);
            return false;
        }
        /// fill up & fill down
        if (curCount == 0) {
            var item = this._createLeftItem(idx, pos);
            item.node.y = this.centers[0];
            return item != null ? true : false;
        }
        /// fill left & fill right
        var leftItem = this._items[0];
        var rightItem = this._items[curCount - 1];
        var right_right = this._getItemRight(rightItem);
        if (curCount > 1) {
            /// recycle left item
            var canRecycleLeft = (rightItem.itemIdx !== (this._totalcount - 1) || right_right > this.rightBoundary);
            if (canRecycleLeft && this._getItemRight(leftItem) < (this.leftBoundary - this._maxPadding)) {
                this._items.splice(0, 1);
                this._recycle(leftItem);
                return true;
            }
            /// recycle right item
            // if( this._getItemLeft(rightItem) > (this.rightBoundary + this._maxPadding)) {
            if (leftItem.itemIdx > 0 && this._getItemLeft(rightItem) > (this.rightBoundary + this._maxPadding)) {
                this._items.splice(curCount - 1, 1);
                this._recycle(rightItem);
                return true;
            }
        }
        /// create left item
        if (this._getItemLeft(leftItem) > this.leftBoundary || (leftItem.itemIdx % this.gridCount) !== 0) {
            var item = this._createNewItem(leftItem.itemIdx - 1);
            if (item) {
                var c = item.itemIdx % this.gridCount;
                item.node.x = c !== (this.gridCount - 1) ? leftItem.node.x : leftItem.node.x - item.node.width - item.padding;
                item.node.y = this.centers[c];
                this._items.splice(0, 0, item);
                return true;
            }
        }
        /// create bottom item
        if (right_right < this.rightBoundary || (rightItem.itemIdx % this.gridCount) !== (this.gridCount - 1)) {
            var item = this._createNewItem(rightItem.itemIdx + 1);
            if (item) {
                var c = item.itemIdx % this.gridCount;
                item.node.x = c !== 0 ? rightItem.node.x : rightItem.node.x + rightItem.node.width + rightItem.padding;
                item.node.y = this.centers[c];
                this._items.push(item);
                return true;
            }
        }
        return false;
    };
    LoopListGrid.prototype._updateVertical = function (idx, pos) {
        var curCount = this._items.length;
        /// recycle all items
        if (this._totalcount == 0) {
            curCount > 0 && this._recycleAllItems(true);
            return false;
        }
        /// fill up & fill down
        if (curCount === 0) {
            var realidx = Math.floor(idx / this.gridCount); // idx % this.gridCount
            var item = this._createTopItem(realidx, pos);
            item.node.x = this.centers[0];
            return item != null;
        }
        /// recycle top item 回收顶部数据 如果最底下的item 是最后一条那么不回收上面的item
        var topitem = this._items[0];
        var bottomitem = this._items[curCount - 1];
        var bottom_bottom = this._getItemBottom(bottomitem);
        if (curCount > 1) {
            /// recycle top item
            var canRecycleTop = (bottomitem.itemIdx !== this._totalcount - 1 || bottom_bottom < this._bottomBoundary);
            if (canRecycleTop && this._getItemBottom(topitem) > (this.topBoundary + this._maxPadding)) {
                this._items.splice(0, 1);
                this._recycle(topitem);
                return true;
            }
            /// recycle bottom item topitem.itemIdx > 0 &&
            if (topitem.itemIdx > 0 && this._getItemTop(bottomitem) < (this.bottomBoundary - this._maxPadding)) {
                // if( this._getItemTop( bottomitem) < (this.bottomBoundary - this._maxPadding)) {
                this._items.splice(curCount - 1, 1);
                this._recycle(bottomitem);
                return true;
            }
        }
        /// create top items
        if (this._getItemTop(topitem) < this.topBoundary || (topitem.itemIdx % this.gridCount) !== 0) {
            var item = this._createNewItem(topitem.itemIdx - 1);
            if (item) {
                var c = item.itemIdx % this.gridCount;
                item.node.y = c !== (this.gridCount - 1) ? topitem.node.y : topitem.node.y + item.padding + item.node.height;
                item.node.x = this.centers[c];
                this._items.splice(0, 0, item);
                return true;
            }
        }
        /// create bottom items
        if (bottom_bottom > this.bottomBoundary || (bottomitem.itemIdx % this.gridCount) !== (this.gridCount - 1)) {
            var item = this._createNewItem(bottomitem.itemIdx + 1);
            if (item) {
                var c = item.itemIdx % this.gridCount;
                item.node.y = c !== 0 ? bottomitem.node.y : bottomitem.node.y - bottomitem.node.height - bottomitem.padding;
                item.node.x = this.centers[c];
                this._items.push(item);
                return true;
            }
        }
        return false;
    };
    LoopListGrid.prototype._updateVerticalItems = function () {
        if (this._items.length > 1) {
            var pitem = this._items[0];
            for (var idx = 1; idx < this._items.length; idx++) {
                var item = this._items[idx];
                var c = item.itemIdx % this.gridCount;
                item.node.y = c !== 0 ? pitem.node.y : pitem.node.y - pitem.node.height - item.padding;
                item.node.x = this.centers[c];
                pitem = item;
            }
        }
    };
    LoopListGrid.prototype._updateHorizontalItems = function () {
        if (this._items.length > 1) {
            var preitem = this._items[0];
            for (var idx = 1; idx < this._items.length; idx++) {
                var item = this._items[idx];
                var c = item.itemIdx % this.gridCount;
                item.node.x = c !== 0 ? preitem.node.x : preitem.node.x + preitem.node.height + item.padding;
                item.node.y = this.centers[c];
                preitem = item;
            }
        }
    };
    __decorate([
        property(cc.Integer)
    ], LoopListGrid.prototype, "gridCount", void 0);
    LoopListGrid = __decorate([
        ccclass,
        disallowMultiple(),
        menu("UIExtension/LoopListGrid")
    ], LoopListGrid);
    return LoopListGrid;
}(LoopList_1.default));
exports.default = LoopListGrid;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9sb29wbGlzdC9Mb29wTGlzdEdyaWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHVDQUFnRDtBQUUxQyxJQUFBLGtCQUEyRCxFQUExRCxvQkFBTyxFQUFFLHNCQUFRLEVBQUUsY0FBSSxFQUFFLHNDQUFpQyxDQUFDO0FBS2xFO0lBQTBDLGdDQUFRO0lBSGxEO1FBQUEscUVBbUxDO1FBOUtHLCtDQUErQztRQUV2QyxlQUFTLEdBQVcsQ0FBQyxDQUFBO1FBRTdCLGtCQUFrQjtRQUNsQixhQUFPLEdBQWEsRUFBRSxDQUFDOztJQXlLM0IsQ0FBQztJQXZLRyxjQUFjO0lBQ2QseUNBQWtCLEdBQWxCO1FBQ0ksaUJBQU0sa0JBQWtCLFdBQUUsQ0FBQTtRQUMxQixJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUM7WUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO1lBQ3BDLFFBQVEsSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDbkIsS0FBSyxtQkFBUSxDQUFDLFVBQVU7b0JBQUM7d0JBQ3JCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUE7d0JBQy9DLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxJQUFJLEdBQUMsR0FBRyxDQUFBO3dCQUNoRCxLQUFLLElBQUksR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUUsRUFBQzs0QkFDMUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQUcsSUFBSSxHQUFDLEdBQUcsQ0FBQTt5QkFDdkM7cUJBQ0o7b0JBQUMsTUFBTTtnQkFDUixLQUFLLG1CQUFRLENBQUMsUUFBUTtvQkFBRTt3QkFDcEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTt3QkFDOUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxHQUFHLEdBQUcsSUFBSSxHQUFDLEdBQUcsQ0FBQTt3QkFDaEQsS0FBSyxJQUFJLEdBQUcsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLEVBQUM7NEJBQzFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxHQUFHLElBQUksR0FBQyxHQUFHLENBQUE7eUJBQ3ZDO3FCQUNKO29CQUFDLE1BQU07YUFDWDtTQUNKO0lBQ0wsQ0FBQztJQUVELFVBQVU7SUFDQSx3Q0FBaUIsR0FBM0IsVUFBNkIsR0FBVyxFQUFFLEdBQVc7UUFDakQsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUE7UUFDakMscUJBQXFCO1FBQ3JCLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLEVBQUU7WUFDdkIsUUFBUSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUUsSUFBSSxDQUFDLENBQUE7WUFDNUMsT0FBTyxLQUFLLENBQUE7U0FDZjtRQUNELHVCQUF1QjtRQUN2QixJQUFJLFFBQVEsSUFBSSxDQUFDLEVBQUU7WUFDZixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtZQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQzdCLE9BQU8sSUFBSSxJQUFJLElBQUksQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUE7U0FDbkM7UUFDRCwwQkFBMEI7UUFDMUIsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUM3QixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFFLFFBQVEsR0FBQyxDQUFDLENBQUMsQ0FBQTtRQUN4QyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFFLFNBQVMsQ0FBQyxDQUFBO1FBQ2hELElBQUksUUFBUSxHQUFHLENBQUMsRUFBRTtZQUNkLHFCQUFxQjtZQUNyQixJQUFJLGNBQWMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7WUFDdkcsSUFBSSxjQUFjLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBRSxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUMxRixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7Z0JBQ3pCLElBQUksQ0FBQyxRQUFRLENBQUUsUUFBUSxDQUFDLENBQUE7Z0JBQ3hCLE9BQU8sSUFBSSxDQUFBO2FBQ2Q7WUFDRCxzQkFBc0I7WUFDdEIsZ0ZBQWdGO1lBQ2hGLElBQUksUUFBUSxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUNoRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBRSxRQUFRLEdBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFFLFNBQVMsQ0FBQyxDQUFBO2dCQUN6QixPQUFPLElBQUksQ0FBQTthQUNkO1NBQ0o7UUFDRCxvQkFBb0I7UUFDcEIsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFFLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDN0YsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBRSxRQUFRLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFBO1lBQ3JELElBQUksSUFBSSxFQUFFO2dCQUNOLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtnQkFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7Z0JBQ3pHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQzdCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7Z0JBQy9CLE9BQU8sSUFBSSxDQUFBO2FBQ2Q7U0FDSjtRQUNELHNCQUFzQjtRQUN0QixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBQyxJQUFJLENBQUMsU0FBUyxDQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2hHLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUUsU0FBUyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQTtZQUN0RCxJQUFJLElBQUksRUFBRTtnQkFDTixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUE7Z0JBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFBO2dCQUNwRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBRSxJQUFJLENBQUMsQ0FBQTtnQkFDdkIsT0FBTyxJQUFJLENBQUE7YUFDZDtTQUNKO1FBQ0QsT0FBTyxLQUFLLENBQUE7SUFDaEIsQ0FBQztJQUVTLHNDQUFlLEdBQXpCLFVBQTJCLEdBQVcsRUFBRSxHQUFXO1FBQy9DLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFBO1FBQ2pDLHFCQUFxQjtRQUNyQixJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxFQUFHO1lBQ3hCLFFBQVEsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFFLElBQUksQ0FBQyxDQUFBO1lBQzVDLE9BQU8sS0FBSyxDQUFBO1NBQ2Y7UUFDRCx1QkFBdUI7UUFDdkIsSUFBSSxRQUFRLEtBQUssQ0FBQyxFQUFFO1lBQ2hCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQSxDQUFDLHVCQUF1QjtZQUNwRSxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQTtZQUM3QyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQzdCLE9BQU8sSUFBSSxJQUFJLElBQUksQ0FBQTtTQUN0QjtRQUNELHdEQUF3RDtRQUN4RCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzVCLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUUsUUFBUSxHQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3pDLElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUUsVUFBVSxDQUFDLENBQUE7UUFDcEQsSUFBSSxRQUFRLEdBQUcsQ0FBQyxFQUFFO1lBQ2Qsb0JBQW9CO1lBQ3BCLElBQUksYUFBYSxHQUFHLENBQUMsVUFBVSxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsV0FBVyxHQUFDLENBQUMsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO1lBQ3ZHLElBQUksYUFBYSxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDeEYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUN6QixJQUFJLENBQUMsUUFBUSxDQUFFLE9BQU8sQ0FBQyxDQUFBO2dCQUN2QixPQUFPLElBQUksQ0FBQTthQUNkO1lBQ0QsOENBQThDO1lBQzlDLElBQUksT0FBTyxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBRSxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUNyRyxrRkFBa0Y7Z0JBQzlFLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLFFBQVEsR0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7Z0JBQ2xDLElBQUksQ0FBQyxRQUFRLENBQUUsVUFBVSxDQUFDLENBQUE7Z0JBQzFCLE9BQU8sSUFBSSxDQUFBO2FBQ2Q7U0FDSjtRQUNELG9CQUFvQjtRQUNwQixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUUsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN6RixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFFLE9BQU8sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDcEQsSUFBSSxJQUFJLEVBQUU7Z0JBQ04sSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFBO2dCQUNyQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFDLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQTtnQkFDeEcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtnQkFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtnQkFDL0IsT0FBTyxJQUFJLENBQUE7YUFDZDtTQUNKO1FBQ0QsdUJBQXVCO1FBQ3ZCLElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxjQUFjLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFDLElBQUksQ0FBQyxTQUFTLENBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDcEcsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBRSxVQUFVLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFBO1lBQ3ZELElBQUksSUFBSSxFQUFFO2dCQUNOLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtnQkFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQSxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUE7Z0JBQ3pHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQzdCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFFLElBQUksQ0FBQyxDQUFBO2dCQUN2QixPQUFPLElBQUksQ0FBQTthQUNkO1NBQ0o7UUFDRCxPQUFPLEtBQUssQ0FBQTtJQUNoQixDQUFDO0lBRUQsMkNBQW9CLEdBQXBCO1FBQ0ksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDeEIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUMxQixLQUFLLElBQUksR0FBRyxHQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLEVBQUM7Z0JBQzVDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7Z0JBQzNCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQTtnQkFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7Z0JBQ3BGLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQzdCLEtBQUssR0FBRyxJQUFJLENBQUE7YUFDZjtTQUNKO0lBQ0wsQ0FBQztJQUVELDZDQUFzQixHQUF0QjtRQUNJLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3hCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDNUIsS0FBSyxJQUFJLEdBQUcsR0FBQyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxFQUFDO2dCQUM1QyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUMzQixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUE7Z0JBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFBO2dCQUMxRixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUM3QixPQUFPLEdBQUcsSUFBSSxDQUFBO2FBQ2pCO1NBQ0o7SUFDTCxDQUFDO0lBM0tEO1FBREMsUUFBUSxDQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUM7bURBQ087SUFKWixZQUFZO1FBSGhDLE9BQU87UUFDUCxnQkFBZ0IsRUFBRTtRQUNsQixJQUFJLENBQUMsMEJBQTBCLENBQUM7T0FDWixZQUFZLENBZ0xoQztJQUFELG1CQUFDO0NBaExELEFBZ0xDLENBaEx5QyxrQkFBUSxHQWdMakQ7a0JBaExvQixZQUFZIiwiZmlsZSI6IiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvb3BMaXN0LCB7IE1vdmVtZW50IH0gZnJvbSBcIi4vTG9vcExpc3RcIjtcblxuY29uc3Qge2NjY2xhc3MsIHByb3BlcnR5LCBtZW51LCBkaXNhbGxvd011bHRpcGxlfSA9IGNjLl9kZWNvcmF0b3I7XG5cbkBjY2NsYXNzXG5AZGlzYWxsb3dNdWx0aXBsZSgpXG5AbWVudShcIlVJRXh0ZW5zaW9uL0xvb3BMaXN0R3JpZFwiKVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9vcExpc3RHcmlkIGV4dGVuZHMgTG9vcExpc3R7XG5cbiAgICAvLy8g5qC85a2Q5pWw6YePIOm7mOiupOS4ujIsIOWkp+S6jjLml7booajnpLrkuIDooYzmnInlpJrkuKrmiJbkuIDliJfmnInlpJrkuKog6YeH55SoIOW3puWIsOWPs+aIluS4iuWIsOS4i+aOkuWIl+aWueW8j1xuICAgIEBwcm9wZXJ0eSggY2MuSW50ZWdlcilcbiAgICBwcml2YXRlIGdyaWRDb3VudDogbnVtYmVyID0gMlxuICAgIFxuICAgIC8vLyBncmlkIGl0ZW0g5byA5aeL5L2N572uXG4gICAgY2VudGVyczogbnVtYmVyW10gPSBbXTtcblxuICAgIC8vLyDorqHnrpdncmlkIOeahOS4reW/g1xuICAgIF9jYWxjdWxhdGVCb3VuZGFyeSgpe1xuICAgICAgICBzdXBlci5fY2FsY3VsYXRlQm91bmRhcnkoKVxuICAgICAgICBpZiggdGhpcy5jb250ZW50KXtcbiAgICAgICAgICAgIHRoaXMuY2VudGVycy5sZW5ndGggPSB0aGlzLmdyaWRDb3VudFxuICAgICAgICAgICAgc3dpdGNoKCB0aGlzLm1vdmVtZW50KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBNb3ZlbWVudC5Ib3Jpem9udGFsOntcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ZXAgPSB0aGlzLmNvbnRlbnQuaGVpZ2h0IC8gdGhpcy5ncmlkQ291bnRcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5jb250ZW50LmhlaWdodCAqIDAuNSAtIHN0ZXAqMC41XG4gICAgICAgICAgICAgICAgICAgIGZvciggbGV0IGlkeCA9IDA7IGlkeCA8IHRoaXMuZ3JpZENvdW50OyBpZHgrKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNlbnRlcnNbaWR4XSA9IHN0YXJ0IC0gc3RlcCppZHhcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNb3ZlbWVudC5WZXJ0aWNhbDoge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3RlcCA9IHRoaXMuY29udGVudC53aWR0aCAvIHRoaXMuZ3JpZENvdW50XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFydCA9IC10aGlzLmNvbnRlbnQud2lkdGggKiAwLjUgKyBzdGVwKjAuNVxuICAgICAgICAgICAgICAgICAgICBmb3IoIGxldCBpZHggPSAwOyBpZHggPCB0aGlzLmdyaWRDb3VudDsgaWR4Kyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jZW50ZXJzW2lkeF0gPSBzdGFydCArIHN0ZXAqaWR4XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8vIOmHjeWGmeWIm+W7uumAu+i+kVxuICAgIHByb3RlY3RlZCBfdXBkYXRlSG9yaXpvbnRhbCggaWR4OiBudW1iZXIsIHBvczogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjdXJDb3VudCA9IHRoaXMuX2l0ZW1zLmxlbmd0aFxuICAgICAgICAvLy8gcmVjeWNsZSBhbGwgaXRlbXNcbiAgICAgICAgaWYoIHRoaXMuX3RvdGFsY291bnQgPT0gMCkge1xuICAgICAgICAgICAgY3VyQ291bnQgPiAwICYmIHRoaXMuX3JlY3ljbGVBbGxJdGVtcyggdHJ1ZSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIC8vLyBmaWxsIHVwICYgZmlsbCBkb3duXG4gICAgICAgIGlmKCBjdXJDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuX2NyZWF0ZUxlZnRJdGVtKCBpZHgsIHBvcylcbiAgICAgICAgICAgIGl0ZW0ubm9kZS55ID0gdGhpcy5jZW50ZXJzWzBdXG4gICAgICAgICAgICByZXR1cm4gaXRlbSAhPSBudWxsPyB0cnVlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIC8vLyBmaWxsIGxlZnQgJiBmaWxsIHJpZ2h0XG4gICAgICAgIGxldCBsZWZ0SXRlbSA9IHRoaXMuX2l0ZW1zWzBdXG4gICAgICAgIGxldCByaWdodEl0ZW0gPSB0aGlzLl9pdGVtc1sgY3VyQ291bnQtMV1cbiAgICAgICAgbGV0IHJpZ2h0X3JpZ2h0ID0gdGhpcy5fZ2V0SXRlbVJpZ2h0KCByaWdodEl0ZW0pXG4gICAgICAgIGlmKCBjdXJDb3VudCA+IDEpIHtcbiAgICAgICAgICAgIC8vLyByZWN5Y2xlIGxlZnQgaXRlbVxuICAgICAgICAgICAgbGV0IGNhblJlY3ljbGVMZWZ0ID0gKHJpZ2h0SXRlbS5pdGVtSWR4ICE9PSAodGhpcy5fdG90YWxjb3VudCAtIDEpIHx8IHJpZ2h0X3JpZ2h0ID4gdGhpcy5yaWdodEJvdW5kYXJ5KVxuICAgICAgICAgICAgaWYoIGNhblJlY3ljbGVMZWZ0ICYmIHRoaXMuX2dldEl0ZW1SaWdodCggbGVmdEl0ZW0pIDwgKHRoaXMubGVmdEJvdW5kYXJ5IC0gdGhpcy5fbWF4UGFkZGluZykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoIDAsIDEpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVjeWNsZSggbGVmdEl0ZW0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vLyByZWN5Y2xlIHJpZ2h0IGl0ZW1cbiAgICAgICAgICAgIC8vIGlmKCB0aGlzLl9nZXRJdGVtTGVmdChyaWdodEl0ZW0pID4gKHRoaXMucmlnaHRCb3VuZGFyeSArIHRoaXMuX21heFBhZGRpbmcpKSB7XG4gICAgICAgICAgICBpZiggbGVmdEl0ZW0uaXRlbUlkeCA+IDAgJiYgdGhpcy5fZ2V0SXRlbUxlZnQocmlnaHRJdGVtKSA+ICh0aGlzLnJpZ2h0Qm91bmRhcnkgKyB0aGlzLl9tYXhQYWRkaW5nKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZSggY3VyQ291bnQtMSwgMSlcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWN5Y2xlKCByaWdodEl0ZW0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLy8gY3JlYXRlIGxlZnQgaXRlbVxuICAgICAgICBpZiggdGhpcy5fZ2V0SXRlbUxlZnQoIGxlZnRJdGVtKSA+IHRoaXMubGVmdEJvdW5kYXJ5IHx8IChsZWZ0SXRlbS5pdGVtSWR4JXRoaXMuZ3JpZENvdW50KSAhPT0gMCkge1xuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLl9jcmVhdGVOZXdJdGVtKCBsZWZ0SXRlbS5pdGVtSWR4IC0gMSlcbiAgICAgICAgICAgIGlmKCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgbGV0IGMgPSBpdGVtLml0ZW1JZHggJSB0aGlzLmdyaWRDb3VudFxuICAgICAgICAgICAgICAgIGl0ZW0ubm9kZS54ID0gYyAhPT0gKHRoaXMuZ3JpZENvdW50LTEpPyBsZWZ0SXRlbS5ub2RlLng6IGxlZnRJdGVtLm5vZGUueCAtIGl0ZW0ubm9kZS53aWR0aCAtIGl0ZW0ucGFkZGluZyBcbiAgICAgICAgICAgICAgICBpdGVtLm5vZGUueSA9IHRoaXMuY2VudGVyc1tjXVxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZSggMCwgMCwgaXRlbSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vLyBjcmVhdGUgYm90dG9tIGl0ZW1cbiAgICAgICAgaWYoIHJpZ2h0X3JpZ2h0IDwgdGhpcy5yaWdodEJvdW5kYXJ5IHx8IChyaWdodEl0ZW0uaXRlbUlkeCV0aGlzLmdyaWRDb3VudCApICE9PSAodGhpcy5ncmlkQ291bnQtMSkpIHtcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5fY3JlYXRlTmV3SXRlbSggcmlnaHRJdGVtLml0ZW1JZHggKyAxKVxuICAgICAgICAgICAgaWYoIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBsZXQgYyA9IGl0ZW0uaXRlbUlkeCAlIHRoaXMuZ3JpZENvdW50XG4gICAgICAgICAgICAgICAgaXRlbS5ub2RlLnggPSBjICE9PSAwPyByaWdodEl0ZW0ubm9kZS54OiByaWdodEl0ZW0ubm9kZS54ICsgcmlnaHRJdGVtLm5vZGUud2lkdGggKyByaWdodEl0ZW0ucGFkZGluZ1xuICAgICAgICAgICAgICAgIGl0ZW0ubm9kZS55ID0gdGhpcy5jZW50ZXJzW2NdXG4gICAgICAgICAgICAgICAgdGhpcy5faXRlbXMucHVzaCggaXRlbSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBfdXBkYXRlVmVydGljYWwoIGlkeDogbnVtYmVyLCBwb3M6IG51bWJlcikge1xuICAgICAgICBsZXQgY3VyQ291bnQgPSB0aGlzLl9pdGVtcy5sZW5ndGhcbiAgICAgICAgLy8vIHJlY3ljbGUgYWxsIGl0ZW1zXG4gICAgICAgIGlmKCB0aGlzLl90b3RhbGNvdW50ID09IDAgKSB7XG4gICAgICAgICAgICBjdXJDb3VudCA+IDAgJiYgdGhpcy5fcmVjeWNsZUFsbEl0ZW1zKCB0cnVlKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgLy8vIGZpbGwgdXAgJiBmaWxsIGRvd25cbiAgICAgICAgaWYoIGN1ckNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICBsZXQgcmVhbGlkeCA9IE1hdGguZmxvb3IoaWR4L3RoaXMuZ3JpZENvdW50KSAvLyBpZHggJSB0aGlzLmdyaWRDb3VudFxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLl9jcmVhdGVUb3BJdGVtKCByZWFsaWR4LCBwb3MpXG4gICAgICAgICAgICBpdGVtLm5vZGUueCA9IHRoaXMuY2VudGVyc1swXVxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0gIT0gbnVsbFxuICAgICAgICB9XG4gICAgICAgIC8vLyByZWN5Y2xlIHRvcCBpdGVtIOWbnuaUtumhtumDqOaVsOaNriDlpoLmnpzmnIDlupXkuIvnmoRpdGVtIOaYr+acgOWQjuS4gOadoemCo+S5iOS4jeWbnuaUtuS4iumdoueahGl0ZW1cbiAgICAgICAgbGV0IHRvcGl0ZW0gPSB0aGlzLl9pdGVtc1swXVxuICAgICAgICBsZXQgYm90dG9taXRlbSA9IHRoaXMuX2l0ZW1zWyBjdXJDb3VudC0xXVxuICAgICAgICBsZXQgYm90dG9tX2JvdHRvbSA9IHRoaXMuX2dldEl0ZW1Cb3R0b20oIGJvdHRvbWl0ZW0pXG4gICAgICAgIGlmKCBjdXJDb3VudCA+IDEpIHtcbiAgICAgICAgICAgIC8vLyByZWN5Y2xlIHRvcCBpdGVtXG4gICAgICAgICAgICBsZXQgY2FuUmVjeWNsZVRvcCA9IChib3R0b21pdGVtLml0ZW1JZHggIT09IHRoaXMuX3RvdGFsY291bnQtMSB8fCBib3R0b21fYm90dG9tIDwgdGhpcy5fYm90dG9tQm91bmRhcnkpXG4gICAgICAgICAgICBpZiggY2FuUmVjeWNsZVRvcCAmJiB0aGlzLl9nZXRJdGVtQm90dG9tKCB0b3BpdGVtKSA+ICh0aGlzLnRvcEJvdW5kYXJ5ICsgdGhpcy5fbWF4UGFkZGluZykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoIDAsIDEpXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVjeWNsZSggdG9waXRlbSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8vIHJlY3ljbGUgYm90dG9tIGl0ZW0gdG9waXRlbS5pdGVtSWR4ID4gMCAmJlxuICAgICAgICAgICAgaWYoIHRvcGl0ZW0uaXRlbUlkeCA+IDAgJiYgdGhpcy5fZ2V0SXRlbVRvcCggYm90dG9taXRlbSkgPCAodGhpcy5ib3R0b21Cb3VuZGFyeSAtIHRoaXMuX21heFBhZGRpbmcpKSB7XG4gICAgICAgICAgICAvLyBpZiggdGhpcy5fZ2V0SXRlbVRvcCggYm90dG9taXRlbSkgPCAodGhpcy5ib3R0b21Cb3VuZGFyeSAtIHRoaXMuX21heFBhZGRpbmcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faXRlbXMuc3BsaWNlKCBjdXJDb3VudC0xLCAxKVxuICAgICAgICAgICAgICAgIHRoaXMuX3JlY3ljbGUoIGJvdHRvbWl0ZW0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLy8gY3JlYXRlIHRvcCBpdGVtc1xuICAgICAgICBpZiggdGhpcy5fZ2V0SXRlbVRvcCggdG9waXRlbSkgPCB0aGlzLnRvcEJvdW5kYXJ5IHx8ICh0b3BpdGVtLml0ZW1JZHgldGhpcy5ncmlkQ291bnQpICE9PSAwKSB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuX2NyZWF0ZU5ld0l0ZW0oIHRvcGl0ZW0uaXRlbUlkeCAtIDEpXG4gICAgICAgICAgICBpZiggaXRlbSkge1xuICAgICAgICAgICAgICAgIGxldCBjID0gaXRlbS5pdGVtSWR4ICUgdGhpcy5ncmlkQ291bnRcbiAgICAgICAgICAgICAgICBpdGVtLm5vZGUueSA9IGMgIT09ICh0aGlzLmdyaWRDb3VudC0xKT8gdG9waXRlbS5ub2RlLnk6IHRvcGl0ZW0ubm9kZS55ICsgaXRlbS5wYWRkaW5nICsgaXRlbS5ub2RlLmhlaWdodFxuICAgICAgICAgICAgICAgIGl0ZW0ubm9kZS54ID0gdGhpcy5jZW50ZXJzW2NdXG4gICAgICAgICAgICAgICAgdGhpcy5faXRlbXMuc3BsaWNlKCAwLCAwLCBpdGVtKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8vIGNyZWF0ZSBib3R0b20gaXRlbXNcbiAgICAgICAgaWYoIGJvdHRvbV9ib3R0b20gPiB0aGlzLmJvdHRvbUJvdW5kYXJ5IHx8IChib3R0b21pdGVtLml0ZW1JZHgldGhpcy5ncmlkQ291bnQgKSAhPT0gKHRoaXMuZ3JpZENvdW50LTEpKSB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuX2NyZWF0ZU5ld0l0ZW0oIGJvdHRvbWl0ZW0uaXRlbUlkeCArIDEpXG4gICAgICAgICAgICBpZiggaXRlbSkge1xuICAgICAgICAgICAgICAgIGxldCBjID0gaXRlbS5pdGVtSWR4ICUgdGhpcy5ncmlkQ291bnRcbiAgICAgICAgICAgICAgICBpdGVtLm5vZGUueSA9IGMgIT09IDA/IGJvdHRvbWl0ZW0ubm9kZS55OiBib3R0b21pdGVtLm5vZGUueSAtIGJvdHRvbWl0ZW0ubm9kZS5oZWlnaHQgLSBib3R0b21pdGVtLnBhZGRpbmdcbiAgICAgICAgICAgICAgICBpdGVtLm5vZGUueCA9IHRoaXMuY2VudGVyc1tjXVxuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnB1c2goIGl0ZW0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBfdXBkYXRlVmVydGljYWxJdGVtcygpe1xuICAgICAgICBpZiggdGhpcy5faXRlbXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgbGV0IHBpdGVtID0gdGhpcy5faXRlbXNbMF1cbiAgICAgICAgICAgIGZvciggbGV0IGlkeD0xOyBpZHggPCB0aGlzLl9pdGVtcy5sZW5ndGg7IGlkeCsrKXtcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuX2l0ZW1zW2lkeF1cbiAgICAgICAgICAgICAgICBsZXQgYyA9IGl0ZW0uaXRlbUlkeCAlIHRoaXMuZ3JpZENvdW50XG4gICAgICAgICAgICAgICAgaXRlbS5ub2RlLnkgPSBjICE9PSAwPyBwaXRlbS5ub2RlLnk6IHBpdGVtLm5vZGUueSAtIHBpdGVtLm5vZGUuaGVpZ2h0IC0gaXRlbS5wYWRkaW5nXG4gICAgICAgICAgICAgICAgaXRlbS5ub2RlLnggPSB0aGlzLmNlbnRlcnNbY11cbiAgICAgICAgICAgICAgICBwaXRlbSA9IGl0ZW1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIF91cGRhdGVIb3Jpem9udGFsSXRlbXMoKXtcbiAgICAgICAgaWYoIHRoaXMuX2l0ZW1zLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGxldCBwcmVpdGVtID0gdGhpcy5faXRlbXNbMF1cbiAgICAgICAgICAgIGZvciggbGV0IGlkeD0xOyBpZHggPCB0aGlzLl9pdGVtcy5sZW5ndGg7IGlkeCsrKXtcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMuX2l0ZW1zW2lkeF1cbiAgICAgICAgICAgICAgICBsZXQgYyA9IGl0ZW0uaXRlbUlkeCAlIHRoaXMuZ3JpZENvdW50XG4gICAgICAgICAgICAgICAgaXRlbS5ub2RlLnggPSBjICE9PSAwPyBwcmVpdGVtLm5vZGUueDogcHJlaXRlbS5ub2RlLnggKyBwcmVpdGVtLm5vZGUuaGVpZ2h0ICsgaXRlbS5wYWRkaW5nXG4gICAgICAgICAgICAgICAgaXRlbS5ub2RlLnkgPSB0aGlzLmNlbnRlcnNbY11cbiAgICAgICAgICAgICAgICBwcmVpdGVtID0gaXRlbVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSJdfQ==